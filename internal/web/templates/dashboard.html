{{define "content"}}
<div class="app">
    <header class="app-header">
        <a href="#" class="header-brand" id="scroll-top" aria-label="Scroll to top">
            <svg class="brand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v20M2 12h20M4.93 4.93l14.14 14.14M19.07 4.93L4.93 19.07"/>
            </svg>
            <span class="brand-text">onWatch</span>
        </a>
        {{if gt (len .Providers) 1}}
        <div class="provider-tabs" id="provider-tabs" role="tablist" aria-label="Select provider">
            {{range .Providers}}
            <button class="provider-tab {{if eq . $.CurrentProvider}}active{{end}}"
                    data-provider="{{.}}" role="tab" aria-selected="{{if eq . $.CurrentProvider}}true{{else}}false{{end}}">
                {{if eq . "synthetic"}}Synthetic{{else if eq . "zai"}}Z.ai{{else if eq . "anthropic"}}Anthropic{{else if eq . "copilot"}}Copilot{{else if eq . "both"}}All{{else}}{{.}}{{end}}
            </button>
            {{end}}
        </div>
        {{end}}
        <div class="header-actions">
            <button class="header-btn" id="refresh-btn" aria-label="Refresh data" title="Refresh now">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
            <div class="header-meta">
                <span class="last-updated" id="last-updated">Last updated: --:--:--</span>
                <span class="timezone-badge" id="timezone-badge"></span>
                <span class="status-indicator" id="status-dot" aria-label="Connection status"></span>
            </div>
        </div>
        <div class="header-controls">
            <a href="/settings" class="header-btn" id="settings-btn" aria-label="Settings" title="Settings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </a>
            <button class="header-btn" id="change-password-btn" aria-label="Change password" title="Change password">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </button>
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
            <a href="/logout" class="header-btn" id="logout-btn" aria-label="Logout" title="Logout">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            </a>
        </div>
    </header>

    <main id="main-content" class="main-content">
        <div class="welcome-banner">
            <h1 class="welcome-title">Dashboard</h1>
            <p class="welcome-subtitle">
                {{if eq .CurrentProvider "both"}}Track all your API quotas in real time.
                {{else}}Track your {{if eq .CurrentProvider "synthetic"}}Synthetic{{else if eq .CurrentProvider "zai"}}Z.ai{{else if eq .CurrentProvider "anthropic"}}Anthropic (Claude Code){{else if eq .CurrentProvider "copilot"}}GitHub Copilot{{else}}{{.CurrentProvider}}{{end}} API quota usage in real time.
                {{end}}
            </p>
        </div>

        {{if eq .CurrentProvider "both"}}
        <!-- Both providers side-by-side -->
        <div class="both-view" id="both-view" data-provider="both">
            <section class="provider-column" data-provider="synthetic">
                <h3 class="provider-label">Synthetic</h3>
                <div class="quota-grid quota-grid-stacked" id="quota-grid-synthetic" data-provider="synthetic">
                    <article class="quota-card" data-quota="subscription" role="button" tabindex="0" aria-label="View Subscription Quota details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>Subscription</h2><span class="countdown" id="countdown-subscription">--:--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-subscription">0%</span><span class="usage-fraction" id="fraction-subscription">0 / 0</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-subscription" style="width: 0%"></div></div></div>
                        <footer class="card-footer"><span class="status-badge" id="status-subscription" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-subscription">Resets: --</span></footer>
                    </article>
                    <article class="quota-card" data-quota="search" role="button" tabindex="0" aria-label="View Search Hourly details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>Search (Hourly)</h2><span class="countdown" id="countdown-search">--:--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-search">0%</span><span class="usage-fraction" id="fraction-search">0 / 0</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-search" style="width: 0%"></div></div></div>
                        <footer class="card-footer"><span class="status-badge" id="status-search" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-search">Resets: --</span></footer>
                    </article>
                    <article class="quota-card" data-quota="toolCalls" role="button" tabindex="0" aria-label="View Tool Call Discounts details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>Tool Calls</h2><span class="countdown" id="countdown-toolCalls-syn">--:--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-toolCalls-syn">0%</span><span class="usage-fraction" id="fraction-toolCalls-syn">0 / 0</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-toolCalls-syn" style="width: 0%"></div></div></div>
                        <footer class="card-footer"><span class="status-badge" id="status-toolCalls-syn" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-toolCalls-syn">Resets: --</span></footer>
                    </article>
                </div>
            </section>
            <section class="provider-column" data-provider="zai">
                <h3 class="provider-label">Z.ai</h3>
                <div class="quota-grid quota-grid-stacked" id="quota-grid-zai" data-provider="zai">
                    <article class="quota-card" data-quota="tokensLimit" role="button" tabindex="0" aria-label="View Tokens Limit details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>Tokens Limit</h2><span class="countdown" id="countdown-tokensLimit">--:--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-tokensLimit">0%</span><span class="usage-fraction" id="fraction-tokensLimit">0 / 200M</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-tokensLimit" style="width: 0%"></div></div></div>
                        <footer class="card-footer"><span class="status-badge" id="status-tokensLimit" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-tokensLimit">Resets: --</span></footer>
                    </article>
                    <article class="quota-card" data-quota="timeLimit" role="button" tabindex="0" aria-label="View Time Limit details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Time Limit</h2><span class="countdown" id="countdown-timeLimit">--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-timeLimit">0%</span><span class="usage-fraction" id="fraction-timeLimit">0 / 1,000</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-timeLimit" style="width: 0%"></div></div></div>
                        <footer class="card-footer"><span class="status-badge" id="status-timeLimit" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-timeLimit"></span></footer>
                    </article>
                    <article class="quota-card" data-quota="toolCalls" role="button" tabindex="0" aria-label="View Tool Calls details">
                        <header class="card-header"><h2 class="quota-title"><svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>Tool Calls</h2><span class="countdown" id="countdown-toolCalls-zai">--</span></header>
                        <div class="progress-stats"><span class="usage-percent" id="percent-toolCalls-zai">0%</span><span class="usage-fraction" id="fraction-toolCalls-zai">0 / 0</span></div>
                        <div class="progress-wrapper"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div class="progress-fill" id="progress-toolCalls-zai" style="width: 0%"></div></div></div>
                        <div class="usage-details" id="usage-details-toolCalls-zai" style="display: none;"></div>
                        <footer class="card-footer"><span class="status-badge" id="status-toolCalls-zai" data-status="healthy"><svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Healthy</span><span class="reset-time" id="reset-toolCalls-zai"></span></footer>
                    </article>
                </div>
            </section>
            {{if .HasAnthropic}}
            <section class="provider-column" data-provider="anthropic">
                <h3 class="provider-label">Anthropic</h3>
                <div class="quota-grid quota-grid-stacked" id="quota-grid-anthropic-both" data-provider="anthropic"></div>
            </section>
            {{end}}
            {{if .HasCopilot}}
            <section class="provider-column" data-provider="copilot">
                <h3 class="provider-label">Copilot <span class="beta-badge">Beta</span></h3>
                <div class="quota-grid quota-grid-stacked" id="quota-grid-copilot-both" data-provider="copilot"></div>
            </section>
            {{end}}
        </div>
        {{else if eq .CurrentProvider "copilot"}}
        <!-- Copilot quota cards (dynamically populated by JS) -->
        <div class="quota-grid" id="quota-grid-copilot" data-provider="copilot"></div>
        {{else if eq .CurrentProvider "anthropic"}}
        <!-- Anthropic quota cards (dynamically populated by JS) -->
        <div class="quota-grid" id="quota-grid-anthropic" data-provider="anthropic"></div>
        {{else}}
        <div class="quota-grid" id="quota-grid" data-provider="{{.CurrentProvider}}">
            {{if eq .CurrentProvider "zai"}}
            <!-- Z.ai quota cards -->
            <article class="quota-card" data-quota="tokensLimit" role="button" tabindex="0" aria-label="View Tokens Limit details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        Tokens Limit
                    </h2>
                    <span class="countdown" id="countdown-tokensLimit">--:--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-tokensLimit">0%</span>
                    <span class="usage-fraction" id="fraction-tokensLimit">0 / 200M</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-tokensLimit" style="width: 0%"></div>
                    </div>
                </div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-tokensLimit" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-tokensLimit">Resets: --</span>
                </footer>
            </article>

            <article class="quota-card" data-quota="timeLimit" role="button" tabindex="0" aria-label="View Time Limit details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Time Limit
                    </h2>
                    <span class="countdown" id="countdown-timeLimit">--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-timeLimit">0%</span>
                    <span class="usage-fraction" id="fraction-timeLimit">0 / 1,000</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-timeLimit" style="width: 0%"></div>
                    </div>
                </div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-timeLimit" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-timeLimit"></span>
                </footer>
            </article>

            <article class="quota-card" data-quota="toolCalls" role="button" tabindex="0" aria-label="View Tool Calls details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        Tool Calls
                    </h2>
                    <span class="countdown" id="countdown-toolCalls">--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-toolCalls">0%</span>
                    <span class="usage-fraction" id="fraction-toolCalls">0 / 0</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-toolCalls" style="width: 0%"></div>
                    </div>
                </div>
                <div class="usage-details" id="usage-details-toolCalls" style="display: none;"></div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-toolCalls" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-toolCalls"></span>
                </footer>
            </article>
            {{else}}
            <!-- Synthetic quota cards -->
            <article class="quota-card" data-quota="subscription" role="button" tabindex="0" aria-label="View Subscription Quota details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                        </svg>
                        Subscription
                    </h2>
                    <span class="countdown" id="countdown-subscription">--:--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-subscription">0%</span>
                    <span class="usage-fraction" id="fraction-subscription">0 / 0</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-subscription" style="width: 0%"></div>
                    </div>
                </div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-subscription" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-subscription">Resets: --</span>
                </footer>
            </article>

            <article class="quota-card" data-quota="search" role="button" tabindex="0" aria-label="View Search Hourly details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                        Search (Hourly)
                    </h2>
                    <span class="countdown" id="countdown-search">--:--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-search">0%</span>
                    <span class="usage-fraction" id="fraction-search">0 / 0</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-search" style="width: 0%"></div>
                    </div>
                </div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-search" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-search">Resets: --</span>
                </footer>
            </article>

            <article class="quota-card" data-quota="toolCalls" role="button" tabindex="0" aria-label="View Tool Call Discounts details">
                <header class="card-header">
                    <h2 class="quota-title">
                        <svg class="quota-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        Tool Calls
                    </h2>
                    <span class="countdown" id="countdown-toolCalls">--:--</span>
                </header>
                <div class="progress-stats">
                    <span class="usage-percent" id="percent-toolCalls">0%</span>
                    <span class="usage-fraction" id="fraction-toolCalls">0 / 0</span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-fill" id="progress-toolCalls" style="width: 0%"></div>
                    </div>
                </div>
                <footer class="card-footer">
                    <span class="status-badge" id="status-toolCalls" data-status="healthy">
                        <svg class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        Healthy
                    </span>
                    <span class="reset-time" id="reset-toolCalls">Resets: --</span>
                </footer>
            </article>
            {{end}}
        </div>
        {{end}}

        <section class="insights-panel">
            <header class="section-header">
                <h3 class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4M12 8h.01"/>
                    </svg>
                    Usage Insights
                </h3>
            </header>
            <div class="insights-stats" id="insights-stats"></div>
            <div class="insights-cards" id="insights-cards">
                <p class="insight-text">Loading insights...</p>
            </div>
        </section>

        <section class="chart-section">
            <header class="section-header">
                <h3 class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"/>
                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                    </svg>
                    Usage Graphs
                </h3>
                <div class="range-selector" role="group" aria-label="Time range">
                    <button class="range-btn" data-range="1h">1h</button>
                    <button class="range-btn active" data-range="6h">6h</button>
                    <button class="range-btn" data-range="24h">24h</button>
                    <button class="range-btn" data-range="7d">7d</button>
                    <button class="range-btn" data-range="30d">30d</button>
                </div>
            </header>
            <div class="chart-container">
                <canvas id="usage-chart"></canvas>
            </div>
        </section>

        <section class="cycle-overview-section">
            <header class="section-header">
                <h3 class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20V10M18 20V4M6 20v-4"/>
                    </svg>
                    Cycle Overview
                </h3>
                <div class="cycles-filters-inline">
                    <div class="filter-group">
                        <span class="filter-label">Period</span>
                        <div class="filter-pills" id="overview-period-pills" role="group" aria-label="Renewal period"></div>
                    </div>
                    <select class="page-size-select" id="overview-page-size" aria-label="Rows per page">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="0">All</option>
                    </select>
                </div>
            </header>
            <div class="table-wrapper">
                <table class="data-table" id="overview-table">
                    <thead id="overview-thead"><tr><th>Loading...</th></tr></thead>
                    <tbody id="overview-tbody">
                        <tr><td class="empty-state">Select a renewal period to view cross-quota data.</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <span class="table-info" id="overview-info">Showing 0-0 of 0</span>
                <span class="table-legend">⚡ = consumption rate per hour</span>
                <div class="table-pagination" id="overview-pagination"></div>
            </div>
        </section>

        <section class="cycles-section">
            <header class="section-header">
                <h3 class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Polling History
                </h3>
                <div class="cycles-filters-inline">
                    <div class="filter-group">
                        <span class="filter-label">Range</span>
                        <div class="filter-pills" id="cycle-range-pills" role="group" aria-label="Time range">
                            <button class="filter-pill" data-range="3600000">1h</button>
                            <button class="filter-pill active" data-range="259200000">3d</button>
                            <button class="filter-pill" data-range="604800000">7d</button>
                            <button class="filter-pill" data-range="1296000000">15d</button>
                            <button class="filter-pill" data-range="2592000000">30d</button>
                        </div>
                    </div>
                    <select class="page-size-select" id="cycles-page-size" aria-label="Rows per page">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="0">All</option>
                    </select>
                </div>
            </header>
            <div class="table-wrapper">
                <table class="data-table" id="cycles-table">
                    <thead id="cycles-thead">
                        <tr>
                            <th data-sort-key="id" role="button" tabindex="0">Cycle <span class="sort-arrow"></span></th>
                            <th data-sort-key="start" role="button" tabindex="0">Start <span class="sort-arrow"></span></th>
                            <th data-sort-key="end" role="button" tabindex="0">End <span class="sort-arrow"></span></th>
                            <th data-sort-key="duration" role="button" tabindex="0">Duration <span class="sort-arrow"></span></th>
                            <th data-sort-key="totalDelta" role="button" tabindex="0">Total Δ <span class="sort-arrow"></span></th>
                        </tr>
                    </thead>
                    <tbody id="cycles-tbody">
                        <tr>
                            <td colspan="5" class="empty-state">No polling data yet. Tracking begins on first poll.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <span class="table-info" id="cycles-info">Showing 0-0 of 0</span>
                <span class="table-legend">⚡ = consumption rate per hour</span>
                <div class="table-pagination" id="cycles-pagination"></div>
            </div>
        </section>

        <section class="sessions-section">
            <header class="section-header">
                <h3 class="section-title">
                    <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    Session History
                </h3>
                <div class="table-controls">
                    <select class="page-size-select" id="sessions-page-size" aria-label="Rows per page">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="30">30</option>
                        <option value="0">All</option>
                    </select>
                </div>
            </header>
            <div class="table-wrapper">
                <table class="data-table" id="sessions-table" data-provider="{{.CurrentProvider}}">
                    <thead>
                        <tr>
                            <th data-sort-key="id" role="button" tabindex="0">Session <span class="sort-arrow"></span></th>
                            <th data-sort-key="start" role="button" tabindex="0">Started <span class="sort-arrow"></span></th>
                            <th data-sort-key="end" role="button" tabindex="0">Ended <span class="sort-arrow"></span></th>
                            <th data-sort-key="duration" role="button" tabindex="0">Duration <span class="sort-arrow"></span></th>
                            {{if eq .CurrentProvider "anthropic"}}
                            <th data-sort-key="sub" role="button" tabindex="0" id="anth-session-col-0">5-Hour <span class="sort-arrow"></span></th>
                            <th data-sort-key="search" role="button" tabindex="0" id="anth-session-col-1">Weekly <span class="sort-arrow"></span></th>
                            <th data-sort-key="tool" role="button" tabindex="0" id="anth-session-col-2">Sonnet <span class="sort-arrow"></span></th>
                            {{else if eq .CurrentProvider "zai"}}
                            <th data-sort-key="snapshots" role="button" tabindex="0">Snapshots <span class="sort-arrow"></span></th>
                            {{else}}
                            <th data-sort-key="sub" role="button" tabindex="0">Sub Usage <span class="sort-arrow"></span></th>
                            <th data-sort-key="search" role="button" tabindex="0">Search Usage <span class="sort-arrow"></span></th>
                            <th data-sort-key="tool" role="button" tabindex="0">Tool Usage <span class="sort-arrow"></span></th>
                            {{end}}
                        </tr>
                    </thead>
                    <tbody id="sessions-tbody">
                        <tr>
                            {{if eq .CurrentProvider "zai"}}
                            <td colspan="5" class="empty-state">No sessions recorded yet.</td>
                            {{else}}
                            <td colspan="7" class="empty-state">No sessions recorded yet.</td>
                            {{end}}
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <span class="table-info" id="sessions-info">Showing 0-0 of 0</span>
                <div class="table-pagination" id="sessions-pagination"></div>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <div class="footer-content">
            <span class="footer-brand"><a href="https://onwatch.onllm.dev" class="footer-link" target="_blank" rel="noopener">onWatch v{{.Version}}</a></span>
            <span id="update-badge" class="footer-update" hidden>
                <button id="update-btn" class="footer-update-btn" title="Click to update">
                    Update to v<span id="update-version"></span>
                </button>
            </span>
            <span class="footer-heart">Built with &#10084;&#65039; by <a href="https://prakersh.in" class="footer-link" target="_blank" rel="noopener">Prakersh</a></span>
            <div class="footer-links">
                <a href="https://onllm.dev" class="footer-link" target="_blank" rel="noopener">onllm.dev</a>
                <span class="footer-sep">&#183;</span>
                <a href="https://github.com/onllm-dev/onwatch" class="footer-link" target="_blank" rel="noopener">GitHub</a>
                <span class="footer-sep">&#183;</span>
                <a href="https://buymeacoffee.com/prakersh" class="footer-link footer-support" target="_blank" rel="noopener" title="Support onWatch">Support onWatch</a>
            </div>
        </div>
    </footer>
</div>

<!-- Password Change Modal -->
<div class="modal-overlay" id="password-modal" role="dialog" aria-modal="true" aria-labelledby="password-modal-title" hidden>
    <div class="modal-content" style="max-width:420px">
        <header class="modal-header">
            <h2 class="modal-title" id="password-modal-title">Change Password</h2>
            <button class="modal-close" id="password-modal-close" aria-label="Close modal">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </header>
        <div class="modal-body">
            <form id="password-form">
                <div class="form-group">
                    <label for="current-password">Current Password</label>
                    <input type="password" id="current-password" class="form-input" required autocomplete="current-password">
                </div>
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" class="form-input" required minlength="6" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirm New Password</label>
                    <input type="password" id="confirm-password" class="form-input" required minlength="6" autocomplete="new-password">
                </div>
                <div id="password-error" class="password-error" hidden></div>
                <div id="password-success" class="password-success" hidden></div>
                <button type="submit" class="password-submit-btn" id="password-submit-btn">Update Password</button>
            </form>
        </div>
    </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" id="detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
    <div class="modal-content">
        <header class="modal-header">
            <h2 class="modal-title" id="modal-title">Quota Details</h2>
            <button class="modal-close" id="modal-close" aria-label="Close modal">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
        </header>
        <div class="modal-body" id="modal-body"></div>
    </div>
</div>
{{end}}
